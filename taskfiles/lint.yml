version: '3'

tasks:
  default:
    label: lint
    desc: Run linters
    cmds:
      - task: gha
      - task: json
      - task: renovate
      - task: sh
      - task: yaml

  gha:
    desc: Lint GitHub Actions workflows
    sources:
      - ./.github/workflows/*.yml
    cmds:
      - check-jsonschema --builtin-schema vendor.github-workflows ./.github/workflows/*.yml
      - actionlint

  json:
    desc: Lint JSON files
    sources:
      - ./**/*.json
    cmds:
      - for: sources
        cmd: jq empty {{.ITEM}}
      - for: sources
        cmd: prettier --check --parser json {{.ITEM}}

  renovate:
    desc: Lint Renovate configuration
    sources:
      - ./.github/renovate*.json
    cmds:
      - check-jsonschema --builtin-schema vendor.renovate ./.github/renovate*.json

  sh:
    desc: Lint sh/bash files
    sources:
      - ./**/*.sh
      - ./.githooks/commit-msg
      - ./.githooks/pre-commit
    cmds:
      - shfmt --diff .
      - for: sources
        cmd: shellcheck {{.ITEM}}

  yaml:
    desc: Lint YAML files
    sources:
      - ./**/*.yml
      - ./**/*.yaml
    cmds:
      - yamlfmt -lint .
      - yamllint .
